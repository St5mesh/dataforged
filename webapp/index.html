<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ironsworn: Starforged Webapp</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>Ironsworn: Starforged</h1>
            <nav>
                <button id="nav-session0" class="nav-btn active">Session 0</button>
                <button id="nav-play" class="nav-btn" disabled>Play</button>
                <button id="nav-character" class="nav-btn" disabled>Character</button>
                <button id="nav-log" class="nav-btn" disabled>Scene Log</button>
            </nav>
        </header>

        <main id="main-content">
            <!-- Session 0 Screen -->
            <section id="session0-screen" class="screen active">
                <h2>Character Creation - Session 0</h2>
                
                <div class="creation-step" id="step-truths">
                    <h3>Setting Truths</h3>
                    <p>Select or roll for truths that define your galaxy:</p>
                    <div id="truths-container"></div>
                    <button id="randomize-truths" class="btn">Randomize All Truths</button>
                </div>

                <div class="creation-step" id="step-paths">
                    <h3>Choose Your Paths (2 Required)</h3>
                    <p>Select two path assets that define your character's background and abilities:</p>
                    <div id="paths-container"></div>
                </div>

                <div class="creation-step" id="step-vehicle">
                    <h3>Command Vehicle</h3>
                    <p>Your starship is your home among the stars:</p>
                    <div id="vehicle-container"></div>
                </div>

                <div class="creation-step" id="step-assets">
                    <h3>Third Asset</h3>
                    <p>Choose one additional asset:</p>
                    <div id="assets-container"></div>
                </div>

                <div class="creation-step" id="step-stats">
                    <h3>Assign Stats</h3>
                    <p>Distribute these values: 3, 2, 2, 1, 1</p>
                    <div id="stats-container">
                        <div class="stat">
                            <label>Edge (Speed, agility):</label>
                            <select id="stat-edge">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Heart (Resolve, command):</label>
                            <select id="stat-heart">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Iron (Strength, aggression):</label>
                            <select id="stat-iron">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Shadow (Stealth, deception):</label>
                            <select id="stat-shadow">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Wits (Focus, expertise):</label>
                            <select id="stat-wits">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="creation-step" id="step-vow">
                    <h3>Background Vow</h3>
                    <p>Create an Epic vow that drives your character's story:</p>
                    <textarea id="background-vow" placeholder="Describe your character's epic background vow..."></textarea>
                    <div class="progress-track">
                        <label>Epic Vow Progress:</label>
                        <div class="progress-boxes" id="vow-progress">
                            <!-- Progress boxes will be generated by JS -->
                        </div>
                    </div>
                </div>

                <button id="complete-session0" class="btn btn-primary" disabled>Complete Session 0</button>
            </section>

            <!-- Play Screen -->
            <section id="play-screen" class="screen">
                <h2>Play</h2>
                <div class="play-interface">
                    <div class="scene-frame">
                        <h3>Current Scene</h3>
                        <div class="current-scene-info">
                            <div id="current-scene-display">
                                <h4 id="current-scene-title">Opening Scene</h4>
                                <p id="current-scene-time">Just started</p>
                            </div>
                        </div>
                        <textarea id="scene-description" placeholder="Describe the current scene..."></textarea>
                        <div class="scene-actions">
                            <button id="update-scene" class="btn">Update Scene</button>
                            <button id="frame-new-scene" class="btn">Frame New Scene</button>
                        </div>
                    </div>

                    <div class="move-selection">
                        <h3>Select Move</h3>
                        <select id="move-category">
                            <option value="">Choose a move category...</option>
                        </select>
                        <select id="move-list" disabled>
                            <option value="">Choose a move...</option>
                        </select>
                        <button id="execute-move" class="btn" disabled>Execute Move</button>
                    </div>

                    <div class="always-available">
                        <button id="ask-oracle" class="btn">Ask the Oracle</button>
                        <button id="pay-price" class="btn">Pay the Price</button>
                    </div>

                    <div id="move-interface"></div>
                    <div id="roll-results"></div>
                    
                    <!-- Recent Log Entries -->
                    <div class="recent-log">
                        <h3>Recent Activity</h3>
                        <div id="recent-log-entries" class="log-entries">
                            <!-- Recent entries will be populated here -->
                        </div>
                        <button id="view-full-log" class="btn">View Full Scene Log</button>
                    </div>
                </div>
            </section>

            <!-- Character Screen -->
            <section id="character-screen" class="screen">
                <h2>Character Sheet</h2>
                <div class="character-sheet">
                    <div class="character-stats">
                        <h3>Stats</h3>
                        <div id="character-stats-display"></div>
                    </div>

                    <div class="character-meters">
                        <h3>Condition Meters</h3>
                        <div class="meter">
                            <label>Health:</label>
                            <div id="health-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Spirit:</label>
                            <div id="spirit-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Supply:</label>
                            <div id="supply-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Momentum:</label>
                            <span id="momentum-value">+2</span>
                            <span class="momentum-range">(Max: 10, Reset: +2)</span>
                        </div>

                        <!-- Recovery Actions -->
                        <div class="recovery-actions">
                            <h4>Recovery Moves</h4>
                            <div class="recovery-buttons">
                                <button id="heal-move-btn" class="btn recovery-btn">Heal</button>
                                <button id="hearten-move-btn" class="btn recovery-btn">Hearten</button>
                                <button id="resupply-move-btn" class="btn recovery-btn">Resupply</button>
                                <button id="sojourn-move-btn" class="btn recovery-btn">Sojourn</button>
                                <button id="repair-move-btn" class="btn recovery-btn">Repair</button>
                                <button id="endure-harm-btn" class="btn recovery-btn">Endure Harm</button>
                                <button id="endure-stress-btn" class="btn recovery-btn">Endure Stress</button>
                            </div>
                        </div>
                    </div>

                    <div class="character-assets">
                        <h3>Assets</h3>
                        <div id="character-assets-display"></div>
                    </div>

                    <div class="character-vows">
                        <h3>Vows</h3>
                        <div id="character-vows-display"></div>
                        <button id="add-vow" class="btn">Swear New Vow</button>
                    </div>

                    <div class="character-expeditions">
                        <h3>Expeditions</h3>
                        <div id="expeditions-list"></div>
                    </div>

                    <div class="character-combats">
                        <h3>Active Combats</h3>
                        <div id="combat-list"></div>
                        <button id="add-combat" class="btn">Enter the Fray</button>
                    </div>

                    <div class="character-connections">
                        <h3>Connections</h3>
                        <div id="connections-list"></div>
                        <button id="make-new-connection" class="btn">Make a Connection</button>
                    </div>

                    <div class="progress-tracks-section">
                        <h3>Progress Tracks</h3>
                        <div class="progress-tracks-controls">
                            <button id="add-progress-track" class="btn">Add Progress Track</button>
                            <select id="track-type-filter">
                                <option value="">All Track Types</option>
                                <option value="vow">Vows</option>
                                <option value="expedition">Expeditions</option>
                                <option value="combat">Combat</option>
                                <option value="connection">Connections</option>
                                <option value="legacy">Legacy</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div id="progress-tracks-list"></div>
                    </div>
                </div>
            </section>

            <!-- Scene Log Screen -->
            <section id="log-screen" class="screen">
                <h2>Scene Log</h2>
                <div class="scene-log-interface">
                    <div class="log-controls">
                        <div class="log-filters">
                            <input type="text" id="log-search" placeholder="Search log entries..." />
                            <select id="log-filter-type">
                                <option value="">All Entry Types</option>
                                <option value="move">Moves</option>
                                <option value="oracle">Oracles</option>
                                <option value="narrative">Narrative</option>
                                <option value="state-change">State Changes</option>
                            </select>
                        </div>
                        <div class="log-actions">
                            <button id="add-narrative-entry" class="btn">Add Note</button>
                            <button id="export-log" class="btn">Export Log</button>
                            <button id="clear-log" class="btn btn-danger">Clear All</button>
                        </div>
                    </div>

                    <div class="scenes-list">
                        <h3>Scenes</h3>
                        <div id="scenes-container">
                            <!-- Scenes will be populated here -->
                        </div>
                    </div>

                    <div class="log-entries-display">
                        <h3>Log Entries</h3>
                        <div id="log-entries-container">
                            <!-- Log entries will be populated here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Progress Track Dialog -->
    <div id="progress-track-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3 id="progress-track-dialog-title">Add Progress Track</h3>
            <form id="progress-track-form">
                <div class="form-group">
                    <label for="track-label">Track Name:</label>
                    <input type="text" id="track-label" required placeholder="Enter track name...">
                </div>
                
                <div class="form-group">
                    <label for="track-type">Track Type:</label>
                    <select id="track-type" required>
                        <option value="">Select type...</option>
                        <option value="vow">Vow</option>
                        <option value="expedition">Expedition</option>
                        <option value="combat">Combat</option>
                        <option value="connection">Connection</option>
                        <option value="legacy">Legacy</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="track-rank">Challenge Rank:</label>
                    <select id="track-rank" required>
                        <option value="">Select rank...</option>
                        <option value="troublesome">Troublesome (12 ticks per progress)</option>
                        <option value="dangerous">Dangerous (8 ticks per progress)</option>
                        <option value="formidable">Formidable (4 ticks per progress)</option>
                        <option value="extreme">Extreme (2 ticks per progress)</option>
                        <option value="epic">Epic (1 tick per progress)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="track-description">Description (optional):</label>
                    <textarea id="track-description" placeholder="Describe this track..."></textarea>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-track" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Progress Roll Dialog -->
    <div id="progress-roll-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Progress Roll</h3>
            <div id="progress-roll-content">
                <!-- Content populated by JavaScript -->
            </div>
            <div class="dialog-buttons">
                <button type="button" id="close-progress-roll" class="btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Oracle Dialog -->
    <div id="oracle-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Ask the Oracle</h3>
            <form id="oracle-form">
                <div class="form-group">
                    <label for="oracle-question">Your Question (optional):</label>
                    <input type="text" id="oracle-question" placeholder="What do you want to know?">
                </div>
                
                <div class="form-group">
                    <label for="oracle-category">Oracle Category:</label>
                    <select id="oracle-category" required>
                        <option value="">Select category...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="oracle-name">Oracle:</label>
                    <select id="oracle-name" required>
                        <option value="">Choose an oracle...</option>
                    </select>
                </div>

                <div id="oracle-result" class="oracle-result" style="display: none;">
                    <!-- Result will be displayed here -->
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-oracle" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Roll Oracle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Narrative Entry Dialog -->
    <div id="narrative-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Add Narrative Entry</h3>
            <form id="narrative-form">
                <div class="form-group">
                    <label for="narrative-text">Entry:</label>
                    <textarea id="narrative-text" required placeholder="Describe what happened..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="narrative-category">Category:</label>
                    <select id="narrative-category">
                        <option value="narrative">Narrative</option>
                        <option value="note">Note</option>
                        <option value="discovery">Discovery</option>
                        <option value="clue">Clue</option>
                        <option value="threat">Threat</option>
                    </select>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-narrative" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Entry</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Scene Dialog -->
    <div id="new-scene-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Frame New Scene</h3>
            <form id="new-scene-form">
                <div class="form-group">
                    <label for="new-scene-description">Scene Description:</label>
                    <textarea id="new-scene-description" required placeholder="Describe the new scene..."></textarea>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-new-scene" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Scene</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Recovery Move Dialogs -->
    <!-- Heal Move Dialog -->
    <div id="heal-move-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Heal Move</h3>
            <form id="heal-move-form">
                <div class="move-option">
                    <input type="radio" id="treatment" name="heal-type" value="treatment">
                    <label for="treatment">Receive treatment from someone (+iron)</label>
                    <p class="option-description">Someone with medical expertise tends to your wounds.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="recuperate" name="heal-type" value="recuperate">
                    <label for="recuperate">Recuperate in a safe place (+iron)</label>
                    <p class="option-description">Rest and recover in a secure location.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="heal-asset" name="heal-type" value="heal-asset">
                    <label for="heal-asset">Use healing asset or equipment (+wits)</label>
                    <p class="option-description">Apply medical supplies or technology.</p>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-heal-move" class="btn">Cancel</button>
                    <button type="button" id="execute-heal-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hearten Move Dialog -->
    <div id="hearten-move-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Hearten Move</h3>
            <form id="hearten-move-form">
                <div class="move-option">
                    <input type="radio" id="socialize" name="hearten-type" value="socialize">
                    <label for="socialize">Socialize or seek entertainment (+heart)</label>
                    <p class="option-description">Share fellowship with others and lift your spirits.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="quiet-meditation" name="hearten-type" value="quiet-meditation">
                    <label for="quiet-meditation">Find solace in quiet contemplation (+spirit)</label>
                    <p class="option-description">Meditate, pray, or reflect in solitude.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="creative" name="hearten-type" value="creative">
                    <label for="creative">Create something or indulge in a pastime (+wits)</label>
                    <p class="option-description">Express yourself through art, craft, or hobby.</p>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-hearten-move" class="btn">Cancel</button>
                    <button type="button" id="execute-hearten-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Resupply Move Dialog -->
    <div id="resupply-move-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Resupply Move</h3>
            <form id="resupply-move-form">
                <div class="move-option">
                    <input type="radio" id="barter" name="resupply-type" value="barter">
                    <label for="barter">Barter for supplies (+supply)</label>
                    <p class="option-description">Trade goods or services for needed supplies.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="appeal" name="resupply-type" value="appeal">
                    <label for="appeal">Make an appeal for supplies (+supply)</label>
                    <p class="option-description">Ask for aid based on reputation or relationships.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="trade" name="resupply-type" value="trade">
                    <label for="trade">Trade for needed supplies (+supply)</label>
                    <p class="option-description">Exchange resources for what you need.</p>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-resupply-move" class="btn">Cancel</button>
                    <button type="button" id="execute-resupply-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sojourn Move Dialog -->
    <div id="sojourn-move-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Sojourn Move</h3>
            <form id="sojourn-move-form">
                <div class="move-option">
                    <input type="radio" id="community" name="sojourn-type" value="community">
                    <label for="community">Find aid and comfort in a community (+heart)</label>
                    <p class="option-description">Rest and recover in a welcoming settlement or among allies.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="hospitality" name="sojourn-type" value="hospitality">
                    <label for="hospitality">Seek hospitality or refuge (+heart)</label>
                    <p class="option-description">Appeal for shelter and assistance from others.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="provisions" name="sojourn-type" value="provisions">
                    <label for="provisions">Seek provisions and assistance (+supply)</label>
                    <p class="option-description">Focus on gathering supplies and resources.</p>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-sojourn-move" class="btn">Cancel</button>
                    <button type="button" id="execute-sojourn-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Repair Move Dialog -->
    <div id="repair-move-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Repair Move</h3>
            <form id="repair-move-form">
                <div class="move-option">
                    <input type="radio" id="make-repairs" name="repair-type" value="make-repairs">
                    <label for="make-repairs">Make repairs with available materials (+wits)</label>
                    <p class="option-description">Fix damage using your skills and available parts.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="jury-rig" name="repair-type" value="jury-rig">
                    <label for="jury-rig">Jury-rig a temporary solution (+wits)</label>
                    <p class="option-description">Create a makeshift fix to get things working.</p>
                </div>
                <div class="move-option">
                    <input type="radio" id="field-maintenance" name="repair-type" value="field-maintenance">
                    <label for="field-maintenance">Perform field maintenance (+wits)</label>
                    <p class="option-description">Use maintenance protocols and basic servicing.</p>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-repair-move" class="btn">Cancel</button>
                    <button type="button" id="execute-repair-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Endure Harm Move Dialog -->
    <div id="endure-harm-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Endure Harm Move</h3>
            <form id="endure-harm-form">
                <div class="form-group">
                    <label for="harm-amount">Harm Amount:</label>
                    <select id="harm-amount">
                        <option value="1">1 (Minor harm)</option>
                        <option value="2">2 (Serious harm)</option>
                        <option value="3">3 (Major harm)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="resist-harm">
                    <label for="resist-harm">Resist the harm (make the roll even if health > 0)</label>
                </div>
                
                <div class="strong-hit-options">
                    <h4>Strong Hit Options:</h4>
                    <div class="move-option">
                        <input type="radio" id="shake-off" name="endure-harm-choice" value="shake-off">
                        <label for="shake-off">Shake it off (+1 health if not wounded)</label>
                    </div>
                    <div class="move-option">
                        <input type="radio" id="embrace-pain" name="endure-harm-choice" value="embrace-pain">
                        <label for="embrace-pain">Embrace the pain (+1 momentum)</label>
                    </div>
                </div>
                
                <div class="weak-hit-options">
                    <h4>Weak Hit Option:</h4>
                    <div class="form-group">
                        <input type="checkbox" id="trade-momentum-for-health">
                        <label for="trade-momentum-for-health">Trade momentum for health (-1 momentum, +1 health if not wounded)</label>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-endure-harm-move" class="btn">Cancel</button>
                    <button type="button" id="execute-endure-harm-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Endure Stress Move Dialog -->
    <div id="endure-stress-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Endure Stress Move</h3>
            <form id="endure-stress-form">
                <div class="form-group">
                    <label for="stress-amount">Stress Amount:</label>
                    <select id="stress-amount">
                        <option value="1">1 (Minor stress)</option>
                        <option value="2">2 (Serious stress)</option>
                        <option value="3">3 (Major stress)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="resist-stress">
                    <label for="resist-stress">Resist the stress (make the roll even if spirit > 0)</label>
                </div>
                
                <div class="strong-hit-options">
                    <h4>Strong Hit Options:</h4>
                    <div class="move-option">
                        <input type="radio" id="shake-off-stress" name="endure-stress-choice" value="shake-off">
                        <label for="shake-off-stress">Shake it off (+1 spirit if not shaken)</label>
                    </div>
                    <div class="move-option">
                        <input type="radio" id="embrace-darkness" name="endure-stress-choice" value="embrace-darkness">
                        <label for="embrace-darkness">Embrace the darkness (+1 momentum)</label>
                    </div>
                </div>
                
                <div class="weak-hit-options">
                    <h4>Weak Hit Option:</h4>
                    <div class="form-group">
                        <input type="checkbox" id="trade-momentum-for-spirit">
                        <label for="trade-momentum-for-spirit">Trade momentum for spirit (-1 momentum, +1 spirit if not shaken)</label>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="cancel-endure-stress-move" class="btn">Cancel</button>
                    <button type="button" id="execute-endure-stress-move" class="btn btn-primary">Execute Move</button>
                </div>
            </form>
        </div>
    </div>

    <script src="game-data.js"></script>
    <script src="dice.js"></script>
    <script src="character.js"></script>
    <script src="progress-tracks.js"></script>
    <script src="scene-log.js"></script>
    <script src="moves.js"></script>
    <script src="subflows/vows.js"></script>
    <script src="subflows/expeditions.js"></script>
    <script src="subflows/combat.js"></script>
    <script src="subflows/connections.js"></script>
    <script src="subflows/recovery.js"></script>
    <script src="app.js"></script>
</body>
</html>