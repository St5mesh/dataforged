<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ironsworn: Starforged Webapp</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>Ironsworn: Starforged</h1>
            <nav>
                <button id="nav-session0" class="nav-btn active">Session 0</button>
                <button id="nav-play" class="nav-btn" disabled>Play</button>
                <button id="nav-character" class="nav-btn" disabled>Character</button>
                <button id="nav-log" class="nav-btn" disabled>Scene Log</button>
            </nav>
        </header>

        <main id="main-content">
            <!-- Session 0 Screen -->
            <section id="session0-screen" class="screen active">
                <h2>Character Creation - Session 0</h2>
                
                <div class="creation-step" id="step-truths">
                    <h3>Setting Truths</h3>
                    <p>Select or roll for truths that define your galaxy:</p>
                    <div id="truths-container"></div>
                    <button id="randomize-truths" class="btn">Randomize All Truths</button>
                </div>

                <div class="creation-step" id="step-paths">
                    <h3>Choose Your Paths (2 Required)</h3>
                    <p>Select two path assets that define your character's background and abilities:</p>
                    <div id="paths-container"></div>
                </div>

                <div class="creation-step" id="step-vehicle">
                    <h3>Command Vehicle</h3>
                    <p>Your starship is your home among the stars:</p>
                    <div id="vehicle-container"></div>
                </div>

                <div class="creation-step" id="step-assets">
                    <h3>Third Asset</h3>
                    <p>Choose one additional asset:</p>
                    <div id="assets-container"></div>
                </div>

                <div class="creation-step" id="step-stats">
                    <h3>Assign Stats</h3>
                    <p>Distribute these values: 3, 2, 2, 1, 1</p>
                    <div id="stats-container">
                        <div class="stat">
                            <label>Edge (Speed, agility):</label>
                            <select id="stat-edge">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Heart (Resolve, command):</label>
                            <select id="stat-heart">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Iron (Strength, aggression):</label>
                            <select id="stat-iron">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Shadow (Stealth, deception):</label>
                            <select id="stat-shadow">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                        <div class="stat">
                            <label>Wits (Focus, expertise):</label>
                            <select id="stat-wits">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="creation-step" id="step-vow">
                    <h3>Background Vow</h3>
                    <p>Create an Epic vow that drives your character's story:</p>
                    <textarea id="background-vow" placeholder="Describe your character's epic background vow..."></textarea>
                    <div class="progress-track">
                        <label>Epic Vow Progress:</label>
                        <div class="progress-boxes" id="vow-progress">
                            <!-- Progress boxes will be generated by JS -->
                        </div>
                    </div>
                </div>

                <button id="complete-session0" class="btn btn-primary" disabled>Complete Session 0</button>
            </section>

            <!-- Play Screen -->
            <section id="play-screen" class="screen">
                <h2>Play</h2>
                <div class="play-interface">
                    <div class="scene-frame">
                        <h3>Current Scene</h3>
                        <div class="current-scene-info">
                            <div id="current-scene-display">
                                <h4 id="current-scene-title">Opening Scene</h4>
                                <p id="current-scene-time">Just started</p>
                            </div>
                        </div>
                        <textarea id="scene-description" placeholder="Describe the current scene..."></textarea>
                        <div class="scene-actions">
                            <button id="update-scene" class="btn">Update Scene</button>
                            <button id="frame-new-scene" class="btn">Frame New Scene</button>
                        </div>
                    </div>

                    <div class="move-selection">
                        <h3>Select Move</h3>
                        <select id="move-category">
                            <option value="">Choose a move category...</option>
                        </select>
                        <select id="move-list" disabled>
                            <option value="">Choose a move...</option>
                        </select>
                        <button id="execute-move" class="btn" disabled>Execute Move</button>
                    </div>

                    <div class="always-available">
                        <button id="ask-oracle" class="btn">Ask the Oracle</button>
                        <button id="pay-price" class="btn">Pay the Price</button>
                    </div>

                    <div id="move-interface"></div>
                    <div id="roll-results"></div>
                    
                    <!-- Recent Log Entries -->
                    <div class="recent-log">
                        <h3>Recent Activity</h3>
                        <div id="recent-log-entries" class="log-entries">
                            <!-- Recent entries will be populated here -->
                        </div>
                        <button id="view-full-log" class="btn">View Full Scene Log</button>
                    </div>
                </div>
            </section>

            <!-- Character Screen -->
            <section id="character-screen" class="screen">
                <h2>Character Sheet</h2>
                <div class="character-sheet">
                    <div class="character-stats">
                        <h3>Stats</h3>
                        <div id="character-stats-display"></div>
                    </div>

                    <div class="character-meters">
                        <h3>Condition Meters</h3>
                        <div class="meter">
                            <label>Health:</label>
                            <div id="health-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Spirit:</label>
                            <div id="spirit-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Supply:</label>
                            <div id="supply-meter" class="meter-track"></div>
                        </div>
                        <div class="meter">
                            <label>Momentum:</label>
                            <span id="momentum-value">+2</span>
                            <span class="momentum-range">(Max: 10, Reset: +2)</span>
                        </div>
                    </div>

                    <div class="character-assets">
                        <h3>Assets</h3>
                        <div id="character-assets-display"></div>
                    </div>

                    <div class="character-vows">
                        <h3>Vows</h3>
                        <div id="character-vows-display"></div>
                        <button id="add-vow" class="btn">Swear New Vow</button>
                    </div>

                    <div class="progress-tracks-section">
                        <h3>Progress Tracks</h3>
                        <div class="progress-tracks-controls">
                            <button id="add-progress-track" class="btn">Add Progress Track</button>
                            <select id="track-type-filter">
                                <option value="">All Track Types</option>
                                <option value="vow">Vows</option>
                                <option value="expedition">Expeditions</option>
                                <option value="combat">Combat</option>
                                <option value="connection">Connections</option>
                                <option value="legacy">Legacy</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div id="progress-tracks-list"></div>
                    </div>
                </div>
            </section>

            <!-- Scene Log Screen -->
            <section id="log-screen" class="screen">
                <h2>Scene Log</h2>
                <div class="scene-log-interface">
                    <div class="log-controls">
                        <div class="log-filters">
                            <input type="text" id="log-search" placeholder="Search log entries..." />
                            <select id="log-filter-type">
                                <option value="">All Entry Types</option>
                                <option value="move">Moves</option>
                                <option value="oracle">Oracles</option>
                                <option value="narrative">Narrative</option>
                                <option value="state-change">State Changes</option>
                            </select>
                        </div>
                        <div class="log-actions">
                            <button id="add-narrative-entry" class="btn">Add Note</button>
                            <button id="export-log" class="btn">Export Log</button>
                            <button id="clear-log" class="btn btn-danger">Clear All</button>
                        </div>
                    </div>

                    <div class="scenes-list">
                        <h3>Scenes</h3>
                        <div id="scenes-container">
                            <!-- Scenes will be populated here -->
                        </div>
                    </div>

                    <div class="log-entries-display">
                        <h3>Log Entries</h3>
                        <div id="log-entries-container">
                            <!-- Log entries will be populated here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Progress Track Dialog -->
    <div id="progress-track-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3 id="progress-track-dialog-title">Add Progress Track</h3>
            <form id="progress-track-form">
                <div class="form-group">
                    <label for="track-label">Track Name:</label>
                    <input type="text" id="track-label" required placeholder="Enter track name...">
                </div>
                
                <div class="form-group">
                    <label for="track-type">Track Type:</label>
                    <select id="track-type" required>
                        <option value="">Select type...</option>
                        <option value="vow">Vow</option>
                        <option value="expedition">Expedition</option>
                        <option value="combat">Combat</option>
                        <option value="connection">Connection</option>
                        <option value="legacy">Legacy</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="track-rank">Challenge Rank:</label>
                    <select id="track-rank" required>
                        <option value="">Select rank...</option>
                        <option value="troublesome">Troublesome (12 ticks per progress)</option>
                        <option value="dangerous">Dangerous (8 ticks per progress)</option>
                        <option value="formidable">Formidable (4 ticks per progress)</option>
                        <option value="extreme">Extreme (2 ticks per progress)</option>
                        <option value="epic">Epic (1 tick per progress)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="track-description">Description (optional):</label>
                    <textarea id="track-description" placeholder="Describe this track..."></textarea>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-track" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Track</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Progress Roll Dialog -->
    <div id="progress-roll-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Progress Roll</h3>
            <div id="progress-roll-content">
                <!-- Content populated by JavaScript -->
            </div>
            <div class="dialog-buttons">
                <button type="button" id="close-progress-roll" class="btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Oracle Dialog -->
    <div id="oracle-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Ask the Oracle</h3>
            <form id="oracle-form">
                <div class="form-group">
                    <label for="oracle-question">Your Question:</label>
                    <input type="text" id="oracle-question" placeholder="What do you want to know?">
                </div>
                
                <div class="form-group">
                    <label for="oracle-type">Oracle Type:</label>
                    <select id="oracle-type" required>
                        <option value="">Select oracle type...</option>
                        <option value="yes-no">Yes/No Question</option>
                        <option value="likely">Likely (75% Yes)</option>
                        <option value="unlikely">Unlikely (25% Yes)</option>
                        <option value="small-chance">Small Chance (10% Yes)</option>
                        <option value="sure-thing">Sure Thing (90% Yes)</option>
                    </select>
                </div>

                <div id="oracle-result" class="oracle-result" style="display: none;">
                    <!-- Result will be displayed here -->
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-oracle" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Roll Oracle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Narrative Entry Dialog -->
    <div id="narrative-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Add Narrative Entry</h3>
            <form id="narrative-form">
                <div class="form-group">
                    <label for="narrative-text">Entry:</label>
                    <textarea id="narrative-text" required placeholder="Describe what happened..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="narrative-category">Category:</label>
                    <select id="narrative-category">
                        <option value="narrative">Narrative</option>
                        <option value="note">Note</option>
                        <option value="discovery">Discovery</option>
                        <option value="clue">Clue</option>
                        <option value="threat">Threat</option>
                    </select>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-narrative" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Entry</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Scene Dialog -->
    <div id="new-scene-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <h3>Frame New Scene</h3>
            <form id="new-scene-form">
                <div class="form-group">
                    <label for="new-scene-description">Scene Description:</label>
                    <textarea id="new-scene-description" required placeholder="Describe the new scene..."></textarea>
                </div>

                <div class="dialog-buttons">
                    <button type="button" id="cancel-new-scene" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Scene</button>
                </div>
            </form>
        </div>
    </div>

    <script src="game-data.js"></script>
    <script src="dice.js"></script>
    <script src="character.js"></script>
    <script src="progress-tracks.js"></script>
    <script src="scene-log.js"></script>
    <script src="moves.js"></script>
    <script src="app.js"></script>
</body>
</html>